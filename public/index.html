<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />        
        <meta charset="UTF-8" />

        <title>Sundance chat</title>
        <link rel="stylesheet" href="./sundance.css">

        <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
        <script src="./scripts/audioEngine.js"></script>

    </head>
    <body>
    <button id="login-btn" class="login-btn">Login</button>
    <!-- <div class="player-container">
        <dotlottie-player
            id="lottiePlayer"
            src="https://lottie.host/c0622812-ac4e-4a2f-8678-0f4165553f2f/NAFkq6Fe5M.lottie"
            background="transparent"
            speed="1"
            style="width: 300px; height: 300px"
            loop>

        </dotlottie-player>
    </div> -->
    
    <div class="brand-animated-rect"></div>

    <div class="state-container">
        <div id="state_lbl"></div>
    </div>

    <button class="icon-control" onclick="startSpeak()" aria-label="Start speaking">
        <svg id="start_img" xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none">
            <path d="M12 15c1.66 0 3-1.34 3-3V7c0-1.66-1.34-3-3-3s-3 1.34-3 3v5c0 1.66 1.34 3 3 3zm5-3c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-2.08c3.39-.49 6-3.39 6-6.92h-2z" fill="#fff"/>
        </svg>
    </button>
    <button class="icon-control" onclick="stopSpeak()" aria-label="Stop speaking">
        <svg id="stop_img" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
            <rect x="15" y="15" width="18" height="18" rx="4" fill="#d32f2f"/>
        </svg>
    </button>

        <div id="ticker-container">
            <div id="ticker"></div>
        </div>

    <script>

            function recogniztion_started() {
                state.innerHTML = "I'm listening...";
                player.play();
            }

            function recognition_ended() {
                state.innerHTML = "I'm thinking...";
                player.play();
            }

            const recornition_result = (transcript) => {
                start_img.src = 'https://www.google.com/intl/en/chrome/assets/common/images/content/mic.gif';
                
                ticker.innerHTML - ""
                
                state.innerHTML = transcript;
                conversationTurn()
            }

            function startSpeak() { // User start speaking
                state.innerHTML = "I'm listening...";

                player.stop();
                audioEngine.startRecognition()
            }

            function stopSpeak() { // User stop speaking
                state.innerHTML = "I'm thinking...";

                player.play();
                audioEngine.stopRecognition()
            }

            const audioEngine = new AudioEngine('en', recogniztion_started, recognition_ended, recornition_result);

            const player = document.getElementById("lottiePlayer");
            const state = document.getElementById("state_lbl");

            function conversationTurn() { 

                // fetch('/chat', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //         // 'Authorization': `Bearer ${localStorage.getItem('token')}`
                //     },
                //     body: JSON.stringify({
                //         data: 'Is there a refunds for my municipal taxes?'
                //     })
                // });

                player.stop();
            }


        </script>

<script>
    // Modal logic for Login
    const loginBtn = document.getElementById('login-btn');
    const loginModal = document.getElementById('login-modal');
    const closeLoginModal = document.getElementById('close-login-modal');
    if (loginBtn && loginModal && closeLoginModal) {
        loginBtn.onclick = () => {
            loginModal.style.display = 'flex';
        };
        closeLoginModal.onclick = () => {
            loginModal.style.display = 'none';
        };
        window.onclick = (event) => {
            if (event.target === loginModal) {
                loginModal.style.display = 'none';
            }
        };
    }
</script>

<div id="login-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" id="close-login-modal">&times;</span>
    <h2>Login</h2>
    <p>Login form or instructions go here.</p>
  </div>
</div>
</body>
</html>