# Sundance - plugable AI chatbox
This is both client and server sides of the chatbox.

The client is SPA built with native JS for browser. (currently even no React is used)
The server part is built with Node.js and Express.js.

Sundance is used as a wrapper for GraphQL Server exposed to LLM via the 'universal' tool. 
It depends on the LLM's ability to use the 'function calling' feature.

Practically, Sundance server combines the user's input with a GraphQL schema and asks the LLM tool (executeGraphQL) with a query generated for the specific user's input. The shape of the response is actually defined by the GraphQL schema provided in the prompt. After the tool is called, it tries to execute the query against the configured GraphQL server (via the GRAPHQL_URL environment variable defined in the .env file).

### How to build
1. Re-create .env according to the following template:

```
TOKEN_VALIDATION_URL = "https://api.tel-aviv.gov.il/sso/validate_token"
GRAPHQL_URL = xxx
CLIENT_ID = xxx
LOGIN_SCOPE=xxx
LOGIN_DEVICE_ID=xxx
GEMINI_API_KEY=xxx
ANTHROPIC_API_KEY=xxx
HF_KEY=xxx
PORT=8099
```

2. Run `npm install` to install dependencies
3. Run `npm run build` to build the project
4. Run `npm run start` to start the server 

### How to deploy
This is Node.js application. It can be deployed to any server that supports Node.js, including MS Azure.
Front-end HTML page (index.html) is available once the node app is running.
This page requests the permissions to use microphone, camera and geolocation on the user's device. 

### How to use
1. First the get access token (JWT) Any call to Sundance server should include the access token in the Authorization header (e.g. `Authorization: Bearer <access_token>`).

The tokens are validated against the TOKEN_VALIDATION_URL (e.g. `https://api.tel-aviv.gov.il/sso/validate_token`) endpoint.

2. Issue htpp POST to /chat with this JWT and JSON like:
```
{
    "data": "מה החוב שלי לארנונה?"
} 
```

3. The response will be SSE stream of events generated by final LLM answer.

